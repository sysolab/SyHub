<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plantomio IoT Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<link href="/static/css/styles.css" rel="stylesheet">
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}
h1 {
  color: #333;
  text-align: center;
  margin-bottom: 30px;
}
.chart-container {
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  padding: 15px;
  margin-bottom: 20px;
}
.chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
  gap: 20px;
}
canvas {
  max-height: 300px;
}
.loading {
  text-align: center;
  color: #666;
  padding: 20px;
}
</style>
</head>
<body>
<div class="container">
<h1>Plantomio IoT Dashboard</h1>
<div class="chart-grid" id="charts">
  <div class="chart-container">
    <canvas id="temperature-chart"></canvas>
    <div id="temperature-loading" class="loading">Loading temperature data...</div>
  </div>
  <div class="chart-container">
    <canvas id="pH-chart"></canvas>
    <div id="pH-loading" class="loading">Loading pH data...</div>
  </div>
  <div class="chart-container">
    <canvas id="ORP-chart"></canvas>
    <div id="ORP-loading" class="loading">Loading ORP data...</div>
  </div>
  <div class="chart-container">
    <canvas id="TDS-chart"></canvas>
    <div id="TDS-loading" class="loading">Loading TDS data...</div>
  </div>
  <div class="chart-container">
    <canvas id="EC-chart"></canvas>
    <div id="EC-loading" class="loading">Loading EC data...</div>
  </div>
  <div class="chart-container">
    <canvas id="distance-chart"></canvas>
    <div id="distance-loading" class="loading">Loading distance data...</div>
  </div>
</div>

<script>
const fields = ['temperature', 'pH', 'ORP', 'TDS', 'EC', 'distance'];
const colors = {
  temperature: 'rgba(255, 99, 132, 1)',
  pH: 'rgba(54, 162, 235, 1)',
  ORP: 'rgba(255, 206, 86, 1)',
  TDS: 'rgba(75, 192, 192, 1)',
  EC: 'rgba(153, 102, 255, 1)',
  distance: 'rgba(255, 159, 64, 1)'
};

const chartOptions = {
  responsive: true,
  maintainAspectRatio: false,
  scales: {
    x: { 
      type: 'time',
      time: {
        unit: 'minute',
        displayFormats: {
          minute: 'HH:mm'
        }
      },
      title: {
        display: true,
        text: 'Time'
      }
    },
    y: {
      beginAtZero: false,
      title: {
        display: true,
        text: 'Value'
      }
    }
  },
  plugins: {
    legend: {
      position: 'top',
    },
    tooltip: {
      callbacks: {
        title: function(tooltipItems) {
          return new Date(tooltipItems[0].parsed.x).toLocaleString();
        }
      }
    }
  },
  animation: {
    duration: 1000
  }
};

fields.forEach(field => {
  const loadingElement = document.getElementById(`${field}-loading`);
  
  fetch('/data/' + field)
    .then(response => response.json())
    .then(data => {
      loadingElement.style.display = 'none';
      
      if (data.length === 0) {
        loadingElement.textContent = `No ${field} data available`;
        loadingElement.style.display = 'block';
        return;
      }
      
      const ctx = document.getElementById(field + '-chart').getContext('2d');
      
      // Create field-specific options
      const fieldOptions = JSON.parse(JSON.stringify(chartOptions)); // Deep copy
      fieldOptions.scales.y.title.text = field;
      
      // For pH, set appropriate scale
      if (field === 'pH') {
        fieldOptions.scales.y.min = 0;
        fieldOptions.scales.y.max = 14;
      }
      
      new Chart(ctx, {
        type: 'line',
        data: {
          datasets: [{
            label: field.charAt(0).toUpperCase() + field.slice(1),
            data: data.map(d => ({ x: d.time * 1000, y: d.value })),
            borderColor: colors[field],
            backgroundColor: colors[field].replace('1)', '0.2)'),
            borderWidth: 2,
            pointRadius: 3,
            pointHoverRadius: 5,
            fill: true,
            tension: 0.2
          }]
        },
        options: fieldOptions
      });
    })
    .catch(error => {
      console.error(`Error fetching ${field} data:`, error);
      loadingElement.textContent = `Error loading ${field} data`;
    });
});
</script>
</div>
</body>
</html>